package com.winthier.exploits.bukkit;

import com.winthier.exploits.sql.*;
import java.util.Arrays;
import java.util.List;
import javax.persistence.PersistenceException;
import org.bukkit.plugin.java.JavaPlugin;

public class BukkitExploitsPlugin extends JavaPlugin {
    final BukkitExploits exploits = new BukkitExploits(this);
    final BukkitEventListener listener = new BukkitEventListener(this);
    final BukkitExploitsCommand exploitsCommand = new BukkitExploitsCommand(this);
    
    @Override
    public void onEnable() {
        try {
            for (Class<?> clazz : getDatabaseClasses()) {
                getDatabase().find(clazz).findRowCount();
            }
        } catch (PersistenceException ex) {
            getLogger().info("Installing database for " + getDescription().getName() + " due to first time usage");
            installDDL();
        }
        getServer().getPluginManager().registerEvents(listener, this);
        getCommand("exploits").setExecutor(exploitsCommand);
        exploits.enable();
    }

    @Override
    public void onDisable() {
        exploits.disable();
    }

    @Override
    public List<Class<?>> getDatabaseClasses() {
        return Arrays.asList(
            PlayerTable.class,
            WorldTable.class,
            ChunkTable.class,
            PlayerPlacedBlocksTable.class,
            PlayerIndexTable.class,
            PlayerLocationTable.class,
            PlayerBlockTable.class,
            PlayerEntityTable.class
            );
    }
}
