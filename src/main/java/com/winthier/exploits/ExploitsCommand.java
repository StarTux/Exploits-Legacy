package com.winthier.exploits;

import com.winthier.exploits.sql.DB;
import com.winthier.exploits.sql.PlayerPlacedBlocksTable;
import java.util.Arrays;
import java.util.UUID;
import lombok.RequiredArgsConstructor;

@RequiredArgsConstructor
public class ExploitsCommand {
    private final Exploits exploits;

    public boolean call(UUID sender, String[] args) {
        if (args.length == 0) {
            exploits.send(sender, "Usage: /exploits debug|highlight|flush|deleteplayerplacedblocks");
            return true;
        }
        String command = args[0].toLowerCase();
        args = Arrays.copyOfRange(args, 1, args.length);
        if (args.length == 0 && command.equals("highlight")) {
            if (sender == null) {
                exploits.send(sender, "&cPlayer expected");
            } else {
                exploits.getPlayerPlacedBlocks().highlightPlayerPlacedBlocks(sender);
            }
        } else if (args.length == 0 && command.equals("flush")) {
            exploits.getPlayerPlacedBlocks().flush();
            DB.clearAllCaches();
            exploits.send(sender, "&eAll caches were saved and flushed");
        } else if (args.length == 1 && command.equals("deleteplayerplacedblocks")) {
            String worldName = args[0];
            int count = PlayerPlacedBlocksTable.deleteAllInWorld(worldName);
            exploits.send(sender, "Deleted " + count + " rows from world " + worldName);
        } else if (args.length == 0 && command.equals("debug")) {
            boolean debugMode = !exploits.hasDebugMode(sender);
            exploits.setDebugMode(sender, debugMode);
            exploits.send(sender, "&eDebug mode " + (debugMode ? "enabled" : "disabled"));
        } else {
            return false;
        }
        return true;
    }
}
